<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>The HTML5 Herald</title>
  <style>
    #map {
      width: 100%;
      height: 400px;
    }

    * {
      margin: 0;
      padding: 0;
    }

  </style>
  <script src="data.js" type="text/javascript"></script>
</head>

<body>
  <script>

      partners.forEach(function(partner) {
          //console.log(partner);
      });

      var invalidEntries = 0;

      function filterByID(obj) {
        if ('id' in obj && typeof(obj.id) === 'number' && !isNaN(obj.id)) {
          return true;
        } else {
          invalidEntries++;
          return false;
        }
      }

      function filterByName(obj) {
        if (obj.name == this) {
          return true;
        }
      }

      function filterByLevel(obj) {
        if (obj.level[0].name == this) {
          return true;
        }
      }

      function filterByCountry(obj) {
        if (obj.meta['meta-country'][0] == this) {
          return true;
        }
      }

      function filterByProduct(obj) {
        var ok = false;
        obj.product.forEach(function(product) {
          if (product.slug == 'uhuru') {
            ok = true;
          }
        });
        if (ok)
          return true;
      }

      var arrByID = partners.filter(filterByID);
      //var arrByLevel = partners.filter(filterByLevel, 'Gold');
      //var arrByCountry = partners.filter(filterByCountry, 'Spain');
      //var arrByProduct = partners.filter(filterByProduct);

      //console.log('Filtered Array\n', arrByID);
      //console.log('Filtered Level\n', arrByLevel);
      //console.log('Filtered Country\n', arrByCountry);
      //console.log('Filtered Product\n', arrByProduct);
      // Filtered Array
      // [{ id: 15 }, { id: -1 }, { id: 0 }, { id: 3 }, { id: 12.2 }]

      //console.log('Number of Invalid Entries = ', invalidEntries);

      var neighborhoods = [
        {lat: 52.511, lng: 13.447},
        {lat: 52.549, lng: 13.422},
        {lat: 52.497, lng: 13.396},
        {lat: 52.517, lng: 13.394}
      ];

      var markers = [];
      var map;
      var infowindow;
      var position;
      var bounds;

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'));
        bounds = new google.maps.LatLngBounds();
        for (var i = 0; i < partners.length; i++) {
          position = {
            lat: parseFloat(partners[i].meta['meta-latitude'][0]),
            lng: parseFloat(partners[i].meta['meta-longitude'][0])
          };
           addMarkerWithTimeout(position, i * 500);
        }
        var contentString = '<div id="content">'+
            '<div id="siteNotice">'+
            '</div>'+
            '<h1 id="firstHeading" class="firstHeading">Infotel</h1>'+
            '<div id="bodyContent">'+
            '<p><b>The Infotel Group:</b> From mobile technology to Big Data.</p>'+
            '<p>Web Site: <a href="http://www.infotelcorp.com/">'+
            'http://www.infotelcorp.com/</a> </p>'+
            '</div>'+
            '</div>';

        infowindow = new google.maps.InfoWindow({
          content: contentString
        });
      }

      function getPartnerByName(){
        clearMarkers();
        var name = document.getElementById('inputPartnerName').value;
        if(name){
          var arrByName = partners.filter(filterByName, name);
          position = {
            lat: parseFloat(arrByName[0].meta['meta-latitude'][0]),
            lng: parseFloat(arrByName[0].meta['meta-longitude'][0])
          };
          map.setCenter(position);
          map.setZoom(16);
          addMarkerWithTimeout(position, 200);
        }
        clearForm();
      }

      function clearForm(){
        //document.getElementById('inputPartnerName').value = '';
        document.getElementById('inputPartnerLocation').value = '';
        document.getElementById('inputPartnerProduct').value = '';
        document.getElementById('inputPartnerLevel').value = '';
      }

      function drop() {
        clearMarkers();
        var name = document.getElementById('inputPartnerName').value;
        if(name){
          var arrByName = partners.filter(filterByName, name);
          console.log('Filtered Array By Name:\n', arrByName);
          console.log(arrByName[0].meta['meta-latitude'][0])
          console.log(arrByName[0].meta['meta-longitude'][0])
          var position = {
            lat: parseFloat(arrByName[0].meta['meta-latitude'][0]),
            lng: parseFloat(arrByName[0].meta['meta-longitude'][0])
          };
          map.setCenter(position);
          addMarkerWithTimeout(position, 200);
        }
        //console.log(document.getElementById('inputPartnerName').value);
        //console.log(document.getElementById('inputPartnerName').value);
        //console.log(document.getElementById('inputPartnerName').value);

        // for (var i = 0; i < neighborhoods.length; i++) {
        //   addMarkerWithTimeout(neighborhoods[i], i * 200);
        // }
      }

      function addMarkerWithTimeout(position, timeout) {
        window.setTimeout(function() {
          var marker = new google.maps.Marker({
            position: position,
            map: map,
            animation: google.maps.Animation.DROP
          });

          marker.addListener('click', function() {
            infowindow.open(map, this);
          });

          markers.push(marker);
          bounds.extend(marker.position);
          map.fitBounds(bounds);
        }, timeout);
      }

      function clearMarkers() {
        bounds = null;
        delete bounds;
        bounds = new google.maps.LatLngBounds(null);
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(null);
        }
        markers = [];
      }
  </script>
<form>
  <input id="inputPartnerName" type="text" placeholder="Partner Name" name="partnerName" list="partnerName" onchange="getPartnerByName();"/>
  <datalist id="partnerName">
    <option value="Infotel"></option>
    <option value="Humman's connexion"></option>
    <option value="Objetif Libre"></option>
    <option value="SOSconsulting"></option>
    <option value="Synairgis"></option>
    <option value="NDAlegerie"></option>
    <option value="CAP informatique"></option>
    <option value="ius sonsulting"></option>
    <option value="Loloyai Conseil"></option>
  </datalist>
  <input id="inputPartnerLocation" type="text" placeholder="Partner Location" name="partnerLocation" list="partnerLocation" onchange="drop();"/>
  <datalist id="partnerLocation">
      <option value="Brasil">Brasil</option>
      <option value="Venezuela">Venezuela</option>
      <option value="France">France</option>
      <option value="Spain">Spain</option>
      <option value="Japan">Japan</option>
   </datalist>
   <input id="inputPartnerProduct" type="text" placeholder="Choose a Product" name="partnerProduct" list="partnerProduct" onchange="drop();"/>
   <datalist id="partnerProduct">
      <option value="Armadito">Armadito</option>
      <option value="GLPi">GLPi</option>
      <option value="Kimios">Kimios</option>
      <option value="Stork">Stork</option>
      <option value="Training">Training</option>
      <option value="Uhuru">Uhuru</option>
    </datalist>
   <input id="inputPartnerLevel" type="text" placeholder="Partner Level" name="partnerLevel" list="partnerLevel" onchange="drop();"/>
   <datalist id="partnerLevel">
      <option value="GOLD">GOLD</option>
      <option value="SILVER">SILVER</option>
      <option value="PLATINUM">PLATINUM</option>
    </datalist>
  </form>
  <div id="map"></div>
  <img width="250" height="150" src="../assets/logos/capaltsys.png"/>
  <img width="250" height="150" src="../assets/logos/partner-infotel.jpg"/>
  <img width="250" height="150" src="../assets/logos/iws-consulting.png"/>
  <img width="250" height="150" src="../assets/logos/partner-objectif-libre.jpg"/>
  <img width="250" height="150" src="../assets/logos/lolokai.png"/>
  <img width="250" height="150" src="../assets/logos/partner-sos-consulting.jpg"/>
  <img width="250" height="150" src="../assets/logos/nd-algerie.png"/>
  <img width="250" height="150" src="../assets/logos/partner-synairgis.jpg"/>
  <img width="250" height="150" src="../assets/logos/partner-humans-connexion.jpg"/>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRzzhuR0g7WNMoDLjHpeaotH2DpBlCfik&callback=initMap">
  </script>
</body>
</html>
